# EDCoPilot Chatter File Grammar Specification

This document defines the formal grammar and syntax rules for generating EDCoPilot custom chatter files, based on comprehensive research of EDCoPilot documentation and community resources.

## Overview

EDCoPilot supports multiple types of custom chatter files, each with specific syntax requirements and use cases. This specification ensures generated chatter files conform to EDCoPilot's expected format and will be processed correctly without syntax errors.

## File Types and Purposes

### 1. Space Chatter (`EDCoPilot.SpaceChatter.Custom.txt`)
- **Purpose**: Simulates ambient chatter around stations and in space
- **Context**: Ships requesting docking, departures, traffic control
- **Trigger**: Proximity to stations, in normal space around populated systems

### 2. Crew Chatter (`EDCoPilot.CrewChatter.Custom.txt`)
- **Purpose**: Simulates bridge crew conversations aboard your ship
- **Context**: Internal ship operations, crew interactions
- **Trigger**: Various ship states and activities

### 3. Deep Space Chatter (`EDCoPilot.DeepSpaceChatter.Custom.txt`)
- **Purpose**: Specialized crew chatter for deep space exploration
- **Context**: Remote exploration, crew morale, ship maintenance
- **Trigger**: When >5000ly from both Sol and Colonia

### 4. ChitChat (`EDCoPilot.ChitChat.Custom.txt`)
- **Purpose**: General conversational phrases
- **Context**: Fills quiet periods with ambient commentary
- **Trigger**: When things have been quiet for extended periods

## Formal Grammar Rules

### Basic Line Structure

#### For Space Chatter (Single Line Format)
```
[optional_condition] dialogue_text
```

#### For Crew Chatter (Conversation Format)
```
[example]
[<speaker_role>] dialogue_text_with_tokens
[<speaker_role>] dialogue_text_with_tokens
...
[\example]
```

### Token Replacement Patterns

#### Standard Tokens
- `<cmdrname>` - Commander's name from game state
- `<myshipname>` - Current ship name from game state
- `<cmdraddress>` - Formal address (Sir/Ma'am/Commander based on gender)

#### Dynamic Game State Tokens
These are replaced with actual game data:
- `{SystemName}` - Current system name
- `{StationName}` - Current station name (if docked)
- `{ShipType}` - Current ship type
- `{ShipName}` - Current ship name
- `{Credits}` - Current credit balance
- `{FuelLevel}` - Current fuel level
- `{FuelCapacity}` - Maximum fuel capacity
- `{CommanderName}` - Commander name

### Speaker Role Definitions

#### For Crew Chatter
```
[<EDCoPilot>]     - Ship's computer (uses main EDCoPilot voice)
[<Operations>]    - Operations officer
[<Helm>]          - Helm officer
[<Engineering>]   - Chief engineer
[<Comms>]         - Communications officer
[<Number1>]       - First officer
[<Science>]       - Science officer
[<Security>]      - Security chief
```

#### For Space Chatter (Multi-ship conversations)
```
[<ship1>]         - Primary ship
[<ship2>]         - Secondary ship
[<ship3>]         - Tertiary ship
[<stationname>]   - Station/Control Tower
```

#### Custom Crew Roles
```
<Crew:RoleName>   - Custom role (e.g., <Crew:Maintenance>, <Crew:Navigator>)
```

### Conditional Logic

#### Available Conditions
```
(not-deep-space)  - Excludes if >5000ly from Sol and Colonia
```

#### Game State Conditions (for our implementation)
```
Docked           - When docked at a station
InSupercruise    - When in supercruise
InNormalSpace    - When in normal space
UnderAttack      - When under attack
Scanning         - When scanning objects
Exploring        - When in exploration mode
Trading          - When engaging in trade activities
FuelLow          - When fuel is low (<25%)
ApproachingStation - When approaching a station for docking
ShieldsDown      - When shields are offline
InDanger         - When hull integrity is low
FirstDiscovery   - When making first discovery of a body
DeepSpace        - When >5000ly from Sol and Colonia
```

#### Compound Conditions
```
condition1&condition2  - Both conditions must be true
condition1|condition2  - Either condition must be true (logical OR)
```

### Voice Assignment (Optional)

#### Inline Voice Override
```
[<speaker>]|voice:VoiceName|dialogue_text
```

#### Voice Providers
- `Edge` - Microsoft Edge voices
- `Amazon` - Amazon Polly voices
- `Azure` - Azure Cognitive Services voices
- `GTTS` - Google Text-to-Speech
- `WinTTS` - Windows built-in TTS
- `ElevenLabs` - ElevenLabs voices

### File Structure Rules

#### Comments
```
# This is a comment line
# Comments start with # and are ignored by EDCoPilot
```

#### Blank Lines
- Blank lines between conversations are ignored
- Use for visual separation and organization

#### File Header Template
```
# EDCoPilot [Type] Custom File
# Generated by Elite Dangerous MCP Server
# Format: [condition]|[voice]|dialogue_text
#
# Available Tokens: {dynamic_token_list}
# Available Conditions: {condition_list}
# Available Voices: {voice_list}
#
```

## Format Examples

### Space Chatter Example
```
# Single line format
Traffic control to all vessels, maintain safe distances from the station.
Requesting priority docking clearance for medical emergency.
<myshipname> requesting departure clearance from bay 07.
```

### Crew Chatter Example
```
[example]
[<Operations>] Commander <cmdrname>, we're receiving a priority transmission
[<EDCoPilot>] Routing to your station, <cmdraddress>
[<Comms>] Message decoded and ready for review aboard <myshipname>
[\example]

[example]
[<Engineering>] Fuel reserves at 25%, recommend refueling soon
[<Helm>] Acknowledged, plotting course to nearest fuel source
[<EDCoPilot>] Navigation updated with fuel-efficient routing
[\example]
```

### Conditional Examples
```
# Only when docked
(Docked) Permission to disembark granted, <cmdraddress>

# Only when in supercruise
(InSupercruise) Dropping out of supercruise, <cmdraddress>

# Compound condition
(Scanning&Exploring) Detailed surface scan complete, valuable data acquired
```

## Validation Rules

### Required Elements
1. **File Header**: Must include proper comment header with format description
2. **Proper Delimiters**: Use correct delimiter format for file type
3. **Valid Tokens**: Only use defined token patterns
4. **Valid Speakers**: Use only defined speaker roles
5. **Balanced Tags**: Conversation blocks must have matching [example]/[\example] pairs

### Prohibited Elements
1. **Invalid Characters**: Avoid special characters that could break parsing
2. **Malformed Tokens**: Tokens must use exact syntax (case-sensitive)
3. **Invalid Conditions**: Use only defined condition names
4. **Missing Delimiters**: All elements must be properly separated

### Content Guidelines
1. **Immersive Language**: Use appropriate space/naval terminology
2. **Consistent Tone**: Match Elite Dangerous universe style
3. **Contextual Relevance**: Ensure dialogue matches triggering conditions
4. **Length Limits**: Keep individual lines under 200 characters for voice synthesis
5. **Professional Communication**: Use proper radio/intercom protocols

## Implementation Requirements

### Token Replacement Engine
- Must support all defined token patterns
- Should validate token availability before replacement
- Must handle missing data gracefully (fallback to generic terms)

### Condition Evaluation
- Must support boolean logic (AND, OR, NOT)
- Should validate conditions against current game state
- Must handle undefined conditions gracefully

### File Generation Process
1. **Validate Game State**: Ensure required data is available
2. **Apply Grammar Rules**: Follow format specification exactly
3. **Generate Content**: Create contextually appropriate dialogue
4. **Token Replacement**: Replace all tokens with actual game data
5. **Syntax Validation**: Verify output conforms to specification
6. **File Writing**: Output to correct location with proper encoding

## Error Handling

### Common Syntax Errors
- Missing delimiters or incorrect format
- Invalid token syntax
- Unbalanced conversation blocks
- Invalid condition names

### Recovery Strategies
- Log errors with specific line numbers
- Skip malformed entries rather than failing completely
- Provide fallback generic content when tokens fail
- Validate against grammar before writing files

## Quality Assurance

### Testing Requirements
1. **Grammar Validation**: Verify all generated files parse correctly
2. **Token Testing**: Ensure all tokens resolve to appropriate values
3. **Condition Testing**: Verify conditions trigger appropriately
4. **EDCoPilot Integration**: Test files load without errors in EDCoPilot
5. **Voice Synthesis**: Ensure content works well with TTS systems

### Maintenance
- Keep grammar specification updated with EDCoPilot changes
- Monitor community feedback for format improvements
- Update token definitions as game adds new data
- Maintain backward compatibility when possible

---

**Version**: 1.0
**Last Updated**: September 2025
**Source**: EDCoPilot Documentation Research and Community Analysis
